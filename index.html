<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VibiInvoices - Gerador de Invoices</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="app">
    <!-- Login Screen -->
    <div id="login-screen" class="screen">
      <div class="login-container">
        <h1>VibiInvoices</h1>
        <p>Gere invoices a partir das suas issues completadas no GitHub</p>
        <div class="login-steps">
          <div class="step">
            <span class="step-number">1</span>
            <div class="step-content">
              <a href="https://github.com/settings/tokens/new?description=VibiInvoices&scopes=repo,read:org,read:project" target="_blank" class="btn btn-secondary">
                Criar token no GitHub
              </a>
              <p class="step-hint">Abre o GitHub com as permissões já selecionadas</p>
            </div>
          </div>
          <div class="step">
            <span class="step-number">2</span>
            <div class="step-content">
              <p class="step-hint">Clique em <strong>"Generate token"</strong> (botão verde no fim da página)</p>
            </div>
          </div>
          <div class="step">
            <span class="step-number">3</span>
            <div class="step-content">
              <p class="step-hint">Copie o token gerado (começa com <code>ghp_</code>)</p>
            </div>
          </div>
          <div class="step">
            <span class="step-number">4</span>
            <div class="step-content">
              <input type="password" id="pat-input" placeholder="Cole o token aqui (ghp_...)">
            </div>
          </div>
        </div>
        <button id="login-btn" class="btn btn-primary btn-large">
          <svg viewBox="0 0 16 16" width="20" height="20" fill="currentColor">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
          </svg>
          Entrar
        </button>
        <p class="login-note">O token fica salvo no seu navegador. Você só precisa fazer isso uma vez.</p>
      </div>
    </div>

    <!-- Main Screen -->
    <div id="main-screen" class="screen hidden">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <h1>VibiInvoices</h1>
        </div>
        <div class="header-right">
          <button id="history-btn" class="btn btn-secondary">Histórico</button>
          <button id="settings-btn" class="btn btn-secondary">Configurações</button>
          <div class="user-info">
            <img id="user-avatar" src="" alt="Avatar">
            <span id="user-name"></span>
          </div>
          <button id="logout-btn" class="btn btn-text">Sair</button>
        </div>
      </header>

      <!-- Filters -->
      <div class="filters">
        <div class="filter-group">
          <label>Organização:</label>
          <select id="org-filter">
            <option value="all">Todas</option>
            <option value="StudioVibi">StudioVibi</option>
            <option value="HigherOrderCO">HigherOrderCO</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Período:</label>
          <select id="period-filter">
            <option value="30">Últimos 30 dias</option>
            <option value="60">Últimos 60 dias</option>
            <option value="90">Últimos 90 dias</option>
            <option value="custom">Personalizado</option>
          </select>
        </div>
        <div id="custom-period" class="filter-group hidden">
          <input type="date" id="date-from">
          <span>até</span>
          <input type="date" id="date-to">
          <button id="apply-filter" class="btn btn-small">Aplicar</button>
        </div>
        <button id="refresh-btn" class="btn btn-secondary">Atualizar</button>
      </div>

      <!-- Issues List -->
      <div class="issues-container">
        <div id="loading" class="loading hidden">
          <div class="spinner"></div>
          <p>Carregando issues...</p>
        </div>
        <div id="issues-list" class="issues-list"></div>
        <div id="no-issues" class="no-issues hidden">
          <p>Nenhuma issue encontrada para o período selecionado.</p>
        </div>
      </div>

      <!-- Footer with totals -->
      <footer class="footer">
        <div class="footer-left">
          <span class="selected-count"><span id="selected-count">0</span> issues selecionadas</span>
        </div>
        <div class="footer-center">
          <div class="total-hours">
            <span class="label">Total de Horas:</span>
            <span id="total-hours" class="value">0</span>
          </div>
          <div class="total-amount">
            <span class="label">Valor Total:</span>
            <span id="total-amount" class="value">$0.00</span>
          </div>
        </div>
        <div class="footer-right">
          <button id="generate-btn" class="btn btn-primary btn-large" disabled>Gerar Invoice</button>
        </div>
      </footer>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Configurações</h2>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="contractor-company">Nome da sua empresa (PJ)</label>
            <input type="text" id="contractor-company" placeholder="Ex: Fulano Desenvolvimento LTDA">
          </div>
          <div class="form-group">
            <label for="contractor-id">CNPJ / EIN (opcional)</label>
            <input type="text" id="contractor-id" placeholder="Ex: 12.345.678/0001-90">
          </div>
          <div class="form-group">
            <label for="hourly-rate">Valor por hora</label>
            <div class="input-group">
              <select id="currency">
                <option value="USD">USD</option>
                <option value="BRL">BRL</option>
              </select>
              <input type="number" id="hourly-rate" placeholder="50.00" step="0.01" min="0">
            </div>
          </div>
          <div class="form-group">
            <label for="bank-info">Informações bancárias</label>
            <textarea id="bank-info" rows="5" placeholder="Banco: ...&#10;Agência: ...&#10;Conta: ...&#10;PIX: ..."></textarea>
          </div>
          <div class="form-group">
            <label for="payment-method">Forma de pagamento padrão</label>
            <input type="text" id="payment-method" placeholder="Ex: Wire Transfer, PIX, etc.">
          </div>
        </div>
        <div class="modal-footer">
          <button id="save-settings" class="btn btn-primary">Salvar</button>
        </div>
      </div>
    </div>

    <!-- Invoice Preview Modal -->
    <div id="preview-modal" class="modal hidden">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2>Preview do Invoice</h2>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label for="client-company">Empresa destino</label>
              <select id="client-company">
                <option value="Studio Vibi INC">Studio Vibi INC</option>
                <option value="Higher Order Computing Company">Higher Order Computing Company</option>
              </select>
            </div>
          </div>
          <div class="preview-yaml">
            <pre id="yaml-preview"></pre>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cancel-invoice" class="btn btn-secondary">Cancelar</button>
          <button id="confirm-invoice" class="btn btn-primary">Confirmar e Enviar</button>
        </div>
      </div>
    </div>

    <!-- History Modal -->
    <div id="history-modal" class="modal hidden">
      <div class="modal-content modal-large">
        <div class="modal-header">
          <h2>Histórico de Invoices</h2>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div id="history-loading" class="loading">
            <div class="spinner"></div>
            <p>Carregando histórico...</p>
          </div>
          <div id="history-list" class="history-list"></div>
          <div id="no-history" class="no-issues hidden">
            <p>Nenhum invoice encontrado.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast notifications -->
    <div id="toast-container"></div>
  </div>

  <script src="js/github.js"></script>
  <script src="js/invoice.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
